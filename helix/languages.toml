### Language servers ###


# -------------------------------------------------------------------------
# RUFF LSP (For blazing fast linting and diagnostics)
# -------------------------------------------------------------------------
[language-server.ruff]
command = "ruff"
args = ["server", "--preview"]
preview = true
show-fixes = true

[language-server.ruff.config.settings]
logLevel = "debug"

[language-server.ruff.analyze]
detect-string-imports = true

[language-server.ruff.lint.pydocstyle]
convention = "google"

# -------------------------------------------------------------------------
# PYRIGHT LSP (NEW: For superior static type checking and core LSP features)
# -------------------------------------------------------------------------
[language-server.pyright]
command = "pyright-langserver"
args = ["--stdio"]

# -------------------------------------------------------------------------
# RUST: The standard, high-performance LSP for Rust
# -------------------------------------------------------------------------
[language-server.rust-analyzer]
command = "rust-analyzer"

# -------------------------------------------------------------------------
# TOML/YAML: Fast, robust LSP for configuration files (install taplo-cli)
# -------------------------------------------------------------------------
[language-server.taplo]
command = "taplo"
args = ["lsp", "stdio"]

# -------------------------------------------------------------------------
# JAVASCRIPT/TYPESCRIPT: Standard LSP using tsserver
# -------------------------------------------------------------------------
[language-server.typescript-language-server]
command = "typescript-language-server"
args = ["--stdio"]

# -------------------------------------------------------------------------
# HTML: Standard LSP from VSCode team
# -------------------------------------------------------------------------
[language-server.html-language-server]
command = "html-languageserver"
args = ["--stdio"]

# -------------------------------------------------------------------------
# CSS: Standard LSP from VSCode team (handles CSS, SCSS, LESS)
# -------------------------------------------------------------------------
[language-server.css-language-server]
command = "css-languageserver"
args = ["--stdio"]

# -------------------------------------------------------------------------
# Python (.py)
# -------------------------------------------------------------------------
[[language]]
name = "python"
language-id = "python"
auto-format = true
language-servers = ["pyright", "ruff"]

[language.debugger]
name = "debugpy"
transport = ""
command = ""
args = []

# 3. DEFINE TEMPLATES LOCALLY
[[language.debugger.templates]]
name = "attach-to-server"
request = "attach"
completion = []
args = {}

[language.formatter]
command = "black"
args = ["-", "--quiet", "--fast"]

file-types = ["py", "ipynb"]
comment-token = "#"
shebangs = ["python"]
roots = [
  "pyproject.toml",
  "setup.py",
  "poetry.lock",
  ".git",
  ".jj",
  ".venv/",
  "pyrightconfig.json",
]

# -------------------------------------------------------------------------
# Markdown (.md)
# -------------------------------------------------------------------------
[[language]]
name = "markdown"
language-servers = ["marksman", "markdown-oxide", "mpls"]

[language-server.mpls]
command = "/opt/homebrew/bin/mpls"
config = { markdown.preview.auto = true }

[language-server.marksman]
command = "/opt/homebrew/bin/marksman"
config = { markdown.preview.auto = true }

[language-server.markdown-oxide]
command = "/opt/homebrew/bin/markdown-oxide"
config = { markdown.preview.auto = true }

# -------------------------------------------------------------------------
# RUST (.rs)
# -------------------------------------------------------------------------
[[language]]
name = "rust"
auto-format = true
language-servers = ["rust-analyzer"]
formatter = { command = "rustfmt", args = ["--emit", "stdout"] }

[language.debugger]
name = "lldb-dap"
transport = "stdio"
command = "lldb"

[[language.debugger.templates]]
name = "binary"
request = "launch"
completion = [{ name = "binary", completion = "filename" }]
args = { program = "{0}" }

[[language.debugger.templates]]
name = "binary (terminal)"
request = "launch"
completion = [{ name = "binary", completion = "filename" }]
args = { program = "{0}", runInTerminal = true }

[[language.debugger.templates]]
name = "attach"
request = "attach"
completion = ["pid"]
args = { pid = "{0}" }

[[language.debugger.templates]]
name = "gdbserver attach"
request = "attach"
completion = [
  { name = "lldb connect url", default = "connect://localhost:3333" },
  { name = "file", completion = "filename" },
  "pid",
]
args = { attachCommands = [
  "platform select remote-gdb-server",
  "platform connect {0}",
  "file {1}",
  "attach {2}",
] }

# -------------------------------------------------------------------------
# TOML (.toml)
# -------------------------------------------------------------------------
[[language]]
name = "toml"
auto-format = true
language-servers = ["taplo"]
formatter = { command = "taplo", args = ["format", "-"] }

# -------------------------------------------------------------------------
# YAML (.yaml, .yml)
# -------------------------------------------------------------------------
[[language]]
name = "yaml"
# YAML formatting is typically handled by the LSP (Taplo), no separate formatter needed
language-servers = ["taplo"]
formatter = { command = "taplo", args = ["format", "-"] }

# -------------------------------------------------------------------------
# JAVASCRIPT (.js)
# -------------------------------------------------------------------------
[[language]]
name = "javascript"
auto-format = true
language-servers = ["typescript-language-server"]
# Using prettier and telling it the file type via --stdin-filepath
formatter = { command = "prettier", args = ["--stdin-filepath", "index.js"] }

# -------------------------------------------------------------------------
# TYPESCRIPT (.ts)
# -------------------------------------------------------------------------
[[language]]
name = "typescript"
auto-format = true
language-servers = ["typescript-language-server"]
formatter = { command = "prettier", args = ["--stdin-filepath", "index.ts"] }

# -------------------------------------------------------------------------
# HTML (.html)
# -------------------------------------------------------------------------
[[language]]
name = "html"
auto-format = true
language-servers = ["html-language-server"]
formatter = { command = "prettier", args = ["--stdin-filepath", "index.html"] }

# -------------------------------------------------------------------------
# CSS (.css)
# -------------------------------------------------------------------------
[[language]]
name = "css"
auto-format = true
language-servers = ["css-language-server"]
formatter = { command = "prettier", args = ["--stdin-filepath", "style.css"] }
